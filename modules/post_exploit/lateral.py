class InternalScanner:
    @staticmethod
    def generate_scan_script(ip_prefix="192.168.1", ports="22,80,443,445"):
        """
        Generates a bash script to be executed ON the target server (via RCE)
        to scan internal neighbors.
        """
        script = f"""
#!/bin/bash
# LOCKON Internal Scanner (Lateral Movement)
PREFIX="{ip_prefix}"
PORTS="{ports}"

echo "[*] Starting Internal Scan on $PREFIX.x (Ports: $PORTS)..."

for i in {{1..254}}; do
    TARGET="$PREFIX.$i"
    timeout 1 bash -c "echo >/dev/tcp/$TARGET/80" 2>/dev/null && echo "[+] ALIVE (Web): $TARGET" &
    timeout 1 bash -c "echo >/dev/tcp/$TARGET/445" 2>/dev/null && echo "[+] ALIVE (SMB): $TARGET" &
done
wait
echo "[*] Scan Complete."
"""
        return script.strip()

    @staticmethod
    def suggest_pivot(target_os="linux"):
        if target_os == "linux":
            return "Recommendation: Upload 'socat' or use 'ssh -D' for dynamic port forwarding."
        elif target_os == "windows":
            return "Recommendation: Use 'netsh interface portproxy' or Upload 'chisel.exe' for tunneling."
        return "Unknown OS."
